---
- name: Check if docker is installed
  command: which docker
  register: docker_installed

- name: update yum
  shell: sudo yum update
  when: not docker_installed

- name: install docker
  shell: curl -sSL https://get.docker.com/ | sh
  when: not docker_installed

- name: start docker service
  service: name=docker state=started

- name: create GPG key directory
  file: path=/etc/gpg state=directory

- name: install GPG private.key 
  copy: content="{{private_key}}" dest=/etc/gpg/private.key

- name: pull latest rippled-build-bot container
  shell: sudo docker pull stevenzeiler/rippled-build-bot

- name: run rippled-build-bot container
  shell: sudo docker run -d -p 5000:5000 -v /var/run/docker.sock:/var/run/docker.sock -v /etc/gpg/private.key:/usr/src/app/rpm-builder/private.key -e "AWS_ACCESS_KEY_ID={{aws_access_key_id}}" -e "AWS_SECRET_ACCESS_KEY={{aws_secret_access_key}}" -e "GPG_PASSPHRASE={{gpg_passphrase}}" stevenzeiler/rippled-build-bot

